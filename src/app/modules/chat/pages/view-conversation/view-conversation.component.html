<div *ngIf="(conversationSvc.conversation$ |async) as conversation" class="conversation-container">

    <mat-toolbar class="conversation-toolbar mat-elevation-z2"
                 color="primary">
        <button (click)="closeConversation()" mat-icon-button>
            <mat-icon>arrow_back</mat-icon>
        </button>

        <app-avatars [imageUrl]="conversationAvatar(conversation)"></app-avatars>

        <span>{{conversation.name}}</span>
        <span class="spacer"></span>
        <button
                mat-icon-button
                [matMenuTriggerFor]="menu"
                aria-label="More conversation options">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
            <button mat-menu-item>
                <mat-icon>dialpad</mat-icon>
                <span>Redial</span>
            </button>
            <button mat-menu-item disabled>
                <mat-icon>voicemail</mat-icon>
                <span>Check voice mail</span>
            </button>
            <button mat-menu-item>
                <mat-icon>notifications_off</mat-icon>
                <span>Disable alerts</span>
            </button>
        </mat-menu>
    </mat-toolbar>

    <section *ngIf="(conversationSvc.messages$ | async) as messages" class="messages">
        <div *ngFor="let message of messages; let i = index"
             [ngClass]="{'sent': message.senderId === auth.uid, 'not-delivered': !message.delivered}"
             class="message">

            <app-avatars [imageUrl]="messageAvatar(message.senderId)">
            </app-avatars>
            <!-- <mat-card class="mat-elevation-z"> -->
            <mat-card class="">
                <mat-card-content>
                    <p>
                        {{message.messageBody}}
                    </p>
                </mat-card-content>
            </mat-card>
        </div>
        <div>
            <div *ngFor="let message of conversationSvc.undeliveredMessages$ | async; let i = index"
                 [ngClass]="{'sent': message.senderId === auth.uid, 'not-delivered': !message.delivered}"
                 class="message">

                <app-avatars [imageUrl]="messageAvatar(message.senderId)">
                </app-avatars>
                <!-- <mat-card class="mat-elevation-z"> -->
                <mat-card class="">
                    <mat-card-content>
                        <p>
                            {{message.messageBody}}
                        </p>
                    </mat-card-content>
                </mat-card>
            </div>
        </div>
    </section>
    <section *ngIf="!(conversationSvc.messages$ | async).length as messages" class="messages">
        <div class="flexed center">
            <h1>NO Messages yet, start by sending one</h1>
        </div>
    </section>

    <app-new-meesage-bar></app-new-meesage-bar>
</div>


<!-- ######## NO CONVERSATION SELECTED ######### -->
<div *ngIf="!(conversationSvc.conversation$ |async)" class="conversation-container">
    <h1>Please select or start a conversation</h1>
</div>
